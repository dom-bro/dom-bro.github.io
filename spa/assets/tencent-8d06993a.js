const{toFixed:m,sum:g}=globalThis.SecretWeapon;async function h(t,a,r=30){const i=/^m/.test(a)?a:`m${a}`,n=await fetch(`https://ifzq.gtimg.cn/appstock/app/kline/mkline?param=${t},${i},,${r}&r=${Math.random()}`),{data:c}=await n.json();return c[t][i]}async function f(t,a,r=30){const i=await fetch(`https://proxy.finance.qq.com/ifzqgtimg/appstock/app/newfqkline/get?param=${t},${a},,,${r},qfq&r=${Math.random()}`),{data:n}=await i.json();return n[t][a]||n[t][`qfq${a}`]}async function u(t,a,r=30){let n=await(["day","week"].includes(a)?f:h)(t,a,r);return n=n.map(([c,o,l,s,e,p])=>({datetime:c.replaceAll("-",""),open:+o,close:+l,n:a})),n.forEach((c,o)=>{const l=s=>{const e={};return e.list=n.slice(Math.max(o-s+1,0),o+1),e.avg=g(...e.list.map(p=>p.close))/e.list.length,e};{const s=[3,6,12,24];c.bbi_raw=o<Math.max(...s)-1?null:g(...s.map(e=>l(e).avg))/s.length,c.bbi=c.bbi_raw&&+m(c.bbi_raw,3)}}),n.filter(c=>c.bbi!=null)}function b(t,a){return+m((t-a)/a*100)}export{h as a,b as c,u as g};
