const{toFixed:g,sum:p}=globalThis.SecretWeapon;async function m(e,t,i=30){const n=/^m/.test(t)?t:`m${t}`,a=await fetch(`https://ifzq.gtimg.cn/appstock/app/kline/mkline?param=${e},${n},,${i}&r=${Math.random()}`),{data:r}=await a.json();return r[e][n]}async function h(e,t,i=30){const n=await fetch(`https://proxy.finance.qq.com/ifzqgtimg/appstock/app/newfqkline/get?param=${e},${t},,,${i},qfq&r=${Math.random()}`),{data:a}=await n.json();return a[e][t]||a[e][`qfq${t}`]}async function f(e,t){let n=await(["day","week"].includes(t)?h:m)(e,t);return n=n.map(([a,r,o,c,s,l])=>({datetime:a.replaceAll("-",""),close:+o,n:t})),n.forEach((a,r)=>{const o=c=>{const s={};return s.list=n.slice(Math.max(r-c+1,0),r+1),s.avg=p(...s.list.map(l=>l.close))/s.list.length,s};{const c=[3,6,12,24];a.bbi_raw=r<Math.max(...c)-1?null:p(...c.map(s=>o(s).avg))/c.length,a.bbi=a.bbi_raw&&+g(a.bbi_raw,3)}}),n.filter(a=>a.bbi!=null)}export{m as a,f as g};
